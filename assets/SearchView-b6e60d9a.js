import{f as m,N as v,_ as E}from"./android-chrome-B-192x192-4517b689.js";import{_ as k,r as h,o as n,c,a as l,b as f,w as b,d as L,v as U,F as y,e as C,t as a,f as d,n as S,p as F,g as j}from"./index-b58b0c5a.js";const x={data(){return{searchSharp:m,username:"",allUsers:[],userLogged:this.$store.state.user,allFollows:[],userFollows:[],imgPerfilUser:this.$store.state.img_perfil}},methods:{goToProfile(o){this.$router.push({name:"user-profile",params:{user:o}})},isFollowed(o){return this.userFollows.includes(o)?"Siguiendo":"Seguir"},follow(o){const r="http://localhost:5000/follow";let i={follower_user:this.userLogged,followed_user:o};if(this.userFollows.includes(o)){let u={method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)};fetch(r,u).then(s=>{if(s.ok)return s.json();if(s.status===400)return s.json();throw new Error("Error en la solicitud.")}).then(s=>{s&&s.error?console.log(s.error):(this.userFollows=s.user.map(e=>e.followed_user),this.allFollows=s.all.filter(e=>e.follower_user==this.userLogged),this.allUsers.forEach(e=>{e.user==this.userLogged&&e.follows>0&&(e.follows-=1)}),this.allUsers.forEach(e=>{e.user==o&&e.followers>0&&(e.followers-=1)}))}).catch(s=>{console.error("Error: ",s)})}else{let u={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)};fetch(r,u).then(s=>{if(s.ok)return s.json();if(s.status===400)return s.json();throw new Error("Error en la solicitud.")}).then(s=>{s&&s.error?s.error:(this.userFollows=s.user.map(e=>e.followed_user),this.allFollows=s.all.filter(e=>e.follower_user==this.userLogged),this.allUsers.forEach(e=>{e.user==this.userLogged&&(e.follows+=1)}),this.allUsers.forEach(e=>{e.user==o&&(e.followers+=1)}))}).catch(s=>{console.error("Error: ",s)})}},getAllFollows(){const o=this.userLogged;fetch(`http://localhost:5000/follow/${o}`).then(r=>{if(r.ok)return r.json();throw new Error("Error en la solicitud")}).then(r=>{this.userFollows=r.user.map(i=>i.followed_user),this.allFollows=r.all.filter(i=>i.follower_user==this.userLogged)}).catch(r=>{console.error("Error: ",r)})},getAllUsers(){fetch("http://localhost:5000/search_users").then(o=>{if(o.ok)return o.json();throw new Error("Error en la solicitud")}).then(o=>{this.allUsers=o.users_with_profile,this.allUsers.forEach(r=>{r.img="data:image/jpeg;base64,"+r.img})}).catch(o=>{console.error("Error: ",o)})},filterUser(){if(!this.username)return this.allUsers;const o=this.username.toLowerCase();return this.allUsers.filter(r=>r.user.toLowerCase().startsWith(o)||r.nombre.toLowerCase().startsWith(o))}},components:{Nav:v},mounted(){this.getAllUsers(),this.getAllFollows()}},N=o=>(F("data-v-40b44fd5"),o=o(),j(),o),T={class:"wrapper"},P={class:"container"},V={class:"main"},A={class:"logo"},B=N(()=>l("img",{src:E,alt:"imagen logo"},null,-1)),I={class:"box search"},D={class:"box content"},O=["onClick"],J=["src"],W=["src"],z=["onClick"],M={key:0},q={class:"follows"},G={class:"user-btn"},H=["onClick"];function K(o,r,i,u,s,e){const g=h("Nav"),p=h("router-link"),w=h("ion-icon");return n(),c("div",T,[l("div",P,[f(g),l("main",V,[l("div",A,[f(p,{to:{name:"home"}},{default:b(()=>[B]),_:1})]),l("div",I,[f(w,{src:s.searchSharp},null,8,["src"]),L(l("input",{type:"text",placeholder:"Buscar..","onUpdate:modelValue":r[0]||(r[0]=t=>s.username=t)},null,512),[[U,s.username]])]),l("div",D,[(n(!0),c(y,null,C(e.filterUser(),t=>(n(),c("div",{class:"user",key:t.id},[l("div",{class:"user-img",onClick:_=>e.goToProfile(t.user)},[t.user===s.userLogged?(n(),c("img",{key:0,src:s.imgPerfilUser,alt:"foto perfil"},null,8,J)):(n(),c("img",{key:1,src:t.img,alt:"foto perfil"},null,8,W))],8,O),l("div",{class:"user-name",onClick:_=>e.goToProfile(t.user)},[l("h4",null,"@"+a(t.user),1),t.nombre!=="-"?(n(),c("h5",M,a(t.nombre),1)):d("",!0),l("div",q,[l("p",null,a(t.followers)+" Seguidores",1),l("p",null,a(t.follows)+" Seguidos",1)])],8,z),l("div",G,[t.user!==s.userLogged?(n(),c("button",{key:0,class:S(["btn",{disabled:s.userFollows.includes(t.user)}]),onClick:_=>e.follow(t.user)},a(e.isFollowed(t.user)),11,H)):d("",!0)])]))),128))])])])])}const X=k(x,[["render",K],["__scopeId","data-v-40b44fd5"]]);export{X as default};
